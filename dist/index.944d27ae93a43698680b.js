(()=>{"use strict";var e,t;function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,(r=[{key:"getPrice",value:function(){return this.price||0}},{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function a(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},f(e,t)}function p(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return y(e)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var v,b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(c,e);var t,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=d(r);if(o){var n=d(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return p(this,e)});function c(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),e=i.call(this),"object"===l(c._instance)?p(e,c._instance):(c._instance=y(e),e.setName("shoppingCart"),e.apliedCampaignsMap=new Map,e)}return t=c,(n=[{key:"applyNewCampaign",value:function(e){var t=e.key,n=e.campaign;this.apliedCampaignsMap.set(t,n)}},{key:"removeCampaign",value:function(e){var t=e.key;this.apliedCampaignsMap.delete(t)}},{key:"checkout",value:function(e){return e(this.getPrice())}},{key:"setDeliveryCost",value:function(e){this.deliveryCost=e}},{key:"getProductsAsMap",value:function(){var e=new Map;return this.items.forEach((function(t){e.get(t.code)?e.get(t.code).setQuantity(e.get(t.code).quantity+1):(t.setQuantity(1),e.set(t.code,t))})),e}}])&&s(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(s,e);var t,n,r,o,l=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(r);if(o){var n=u(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return a(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=l.call(this)).items=[],e}return t=s,(n=[{key:"add",value:function(e){this.items.push(e)}},{key:"remove",value:function(e){0!==this.items.length&&e>-1&&this.items.splice(e,1)}},{key:"getPrice",value:function(){return this.items.reduce((function(e,t){return e+t.getPrice()}),0)}}])&&i(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(r));function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},g(e,t)}function w(e,t){if(t&&("object"===m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g(e,t)}(c,e);var t,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(r);if(o){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return w(this,e)});function c(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(r=i.call(this)).setName(e),r.code=t,r.price=n,r.quantity=0,r}return t=c,(n=[{key:"discount",value:function(e){this.price=e(this.getPrice())}},{key:"setQuantity",value:function(e){this.quantity=e}},{key:"getQuantity",value:function(){return this.quantity||0}}])&&h(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),c}(r);const _=JSON.parse('[{"id":1,"name":"Red Plate","code":"R01","price":32.95},{"id":2,"name":"Green Plate","code":"G01","price":24.95},{"id":3,"name":"Blue Plate","code":"B01","price":7.95}]');function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var S=function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n)}var r,o;return r=n,(o=[{key:"apply",value:function(){var n=document.querySelector(".productFeed");_.map((function(e){return new O(e.name,e.code,e.price)})).forEach((function(r){n.appendChild(function(n){var r=document.createElement("div");return r.classList.add("productCard"),r.innerHTML="\n    <h1>".concat(n.name,"</h1>\n    <p>$").concat(n.price,'</p>\n    <button id="').concat(n.code,'">Add to cart</button>'),r.querySelector("button").addEventListener("click",(function(){v.add(n);var r=document.querySelector(".addToCartSnackBar");r.style.display="block",setTimeout((function(){r.style.display="none"}),3e3),document.dispatchEvent(e),document.dispatchEvent(t)})),r}(r))}))}}])&&C(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),n}();const j=function(e,t){for(var n=0;n<e.length;n++)if(e[e.length-n-1].code===t.code)return e.length-n-1};const E=function(e){return e<50?(v.setDeliveryCost(4.95),e+4.95):e<90?(v.setDeliveryCost(2.95),e+2.95):(v.setDeliveryCost(0),e+0)},k=function(e){var t;return(null===(t=v.getProductsAsMap().get("R01"))||void 0===t?void 0:t.quantity)>1?(v.applyNewCampaign({key:"RedPlateCampaign",campaign:{text:"Buy one red plate, get the second half price.",priceToDiscount:Number(v.getProductsAsMap().get("R01").getPrice()/2).toFixed(2)}}),E(e-v.apliedCampaignsMap.get("RedPlateCampaign").priceToDiscount)):(v.apliedCampaignsMap.get("RedPlateCampaign")&&v.removeCampaign({key:"RedPlateCampaign"}),E(e))};function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var q=function(){var e,t=[],n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){a=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(a)throw i}}}}(v.apliedCampaignsMap.values());try{for(n.s();!(e=n.n()).done;){var r=e.value,o=document.createElement("div");o.classList.add("cart__campaign__info"),o.innerHTML="\n    <p>".concat(r.text,"</p>\n    <span>-").concat(r.priceToDiscount,"$</span>\n  "),t.push(o.outerHTML)}}catch(e){n.e(e)}finally{n.f()}return t.join("")};const R=function(){var e=document.createElement("div");return e.innerHTML='\n  <div class="cart__lastPrice">'.concat(v.checkout(k).toFixed(2),'<span>$</span></div>\n  <div class="cart__checkoutBtnWrapper">\n    <button>Checkout</button>\n  </div>\n  <p class="cart__deliveryInfo">\n    Orders under $50 cost $4.95. For orders under $90, delivery costs\n    $2.95. Orders of $90 or more have free delivery.\n  </p>\n  <div class="cart__delivery">\n    <div>delivery</div>\n    ').concat(4.95===v.deliveryCost?"<div>".concat(v.deliveryCost,"$</div>"):"<div>".concat(v.deliveryCost,'$<span class="rawDeliveryCost">',4.95,"$ </span> </div>"),'\n  </div>\n  <div class="cart__price">\n    <div>products</div>\n    <div>').concat(v.getPrice().toFixed(2),'$</div>\n  </div>\n  <div class="cart__campaign">\n    <div>Campaigns</div>\n    ').concat(q(),"\n  </div>\n  "),e},M=function(){if(0===v.items.length)return document.querySelector(".cart").style.display="none",void(document.querySelector(".cartEmptyPage").style.display="flex");document.querySelector(".cartEmptyPage").style.display="none"};function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n)}var r,o;return r=n,(o=[{key:"apply",value:function(){var n=document.querySelector(".cart__products"),r=document.querySelector(".cart__sidebar");document.addEventListener("refreshShoppingCartContent",(function(o){M(),n.innerHTML="",v.getProductsAsMap().forEach((function(r){n.appendChild(function(n){var r=document.createElement("div");return r.classList.add("cart__products__card"),r.innerHTML='\n  <div class="left">\n    <div class="title">'.concat(n.name,'</div>\n    <div class="price">').concat(n.price,'$</div>\n    <p class="campaign__text"> ').concat(function(e){return void 0===e?"":1===e.quantity&&"R01"===e.code?"! Add one more red plate for half price":""}(n),'</p>\n  </div>\n  <div class="right">\n    <button class="increaseBtn"></button>\n    <div class="count">').concat(n.quantity,'</div>\n    <button class="decreaseBtn"></button>\n    <button class="removeBtn"></button>\n  </div>\n'),n.quantity>1&&(r.querySelector(".removeBtn").style.display="none",r.querySelector(".decreaseBtn").style.display="block"),r.querySelector(".increaseBtn").addEventListener("click",(function(){v.add(n),document.dispatchEvent(e),document.dispatchEvent(t)})),r.querySelector(".decreaseBtn").addEventListener("click",(function(){v.remove(j(v.items,n)),document.dispatchEvent(e),document.dispatchEvent(t)})),r.querySelector(".removeBtn").addEventListener("click",(function(){v.remove(j(v.items,n)),document.dispatchEvent(e),document.dispatchEvent(t)})),r}(r))})),r.innerHTML="",r.appendChild(R())}))}}])&&B(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),n}();function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var A=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"apply",value:function(){var e=document.querySelector(".header__basket"),t=document.querySelector(".header__backToShopping"),n=document.querySelector(".productFeed"),r=document.querySelector(".cart"),o=document.querySelector(".cartEmptyPage"),i=document.querySelector(".campaign");e.addEventListener("click",(function(){e.style.visibility="hidden",t.style.visibility="visible",n.style.display="none",r.style.display="flex",i.style.visibility="hidden",M()})),t.addEventListener("click",(function(){e.style.visibility="visible",t.style.visibility="hidden",n.style.display="flex",r.style.display="none",o.style.display="none",i.style.visibility="visible"})),document.addEventListener("refreshCartBadge",(function(t){var n;e.innerHTML="",0!==v.getProductsAsMap().size&&e.appendChild(((n=document.createElement("p")).innerHTML=v.getProductsAsMap().size,n))}))}}],n&&x(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();e=new CustomEvent("refreshShoppingCartContent"),t=new CustomEvent("refreshCartBadge"),(v=new b).setDeliveryCost(4.95);var $=new A,D=new S,H=new L;$.apply(),D.apply(),H.apply()})();